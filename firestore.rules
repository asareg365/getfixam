rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    /* ============================
       PROVIDERS
    ============================ */
    match /providers/{providerId} {
      // Anyone can read approved providers
      allow read: if resource.data.status == 'approved';

      // No client-side writes allowed
      allow write: if false;
    }

    /* ============================
       SERVICES (Public catalog)
    ============================ */
    match /services/{serviceId} {
      allow read: if true;
      allow write: if false;
    }

    /* ============================
       REVIEWS
    ============================ */
    match /reviews/{reviewId} {
      // Anyone can read reviews that have been approved.
      // On a collection query, this rule is checked for every document.
      allow read: if resource.data.status == 'approved';

      // Writes are handled by server actions, no client writes.
      allow write: if false;
    }

    /* ============================
       LOCATIONS (Public data)
    ============================ */
    match /locations/{locationId} {
      allow read: if true;
      allow write: if false;
    }

    /* ============================
       JOBS
    ============================ */
    match /jobs/{jobId} {
      // Only authenticated users can read their own jobs (if you later add ownerId)
      allow read: if request.auth != null;
      allow write: if false;
    }

    /* ============================
       ADMIN LOGIN ATTEMPTS (SERVER ONLY)
    ============================ */
    match /admin_login_attempts/{ipAddress} {
      allow read, write: if false; // server-only via Admin SDK
    }
    
    /* ============================
       SYSTEM SETTINGS (SERVER ONLY)
    ============================ */
    match /system_settings/{settingId} {
        allow read, write: if false; // server-only via Admin SDK
    }

    /* ============================
       AUDIT LOGS (SERVER ONLY)
    ============================ */
    match /auditLogs/{logId} {
      allow read: if false; // server-only via Admin SDK
      allow write: if false; // server-only via Admin SDK
    }

    /* ============================
       DEFAULT DENY
    ============================ */
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
