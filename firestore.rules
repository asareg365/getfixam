
rules_version = '2';

/**
 * FIRESTORE SECURITY RULES: FixAm Ghana (Prototyping Mode)
 * 
 * CORE PHILOSOPHY:
 * This ruleset prioritizes authorization during rapid prototyping. 
 * Public read access is granted for the directory, while writes require authentication.
 */

service cloud.firestore {
  match /databases/{database}/documents {

    // --- GLOBAL HELPER FUNCTIONS ---

    function isSignedIn() {
      return request.auth != null;
    }

    function isExisting() {
      return resource != null;
    }

    // --- COLLECTION RULES ---

    /**
     * @description Rules for the administrators collection.
     */
    match /admins/{adminId} {
      // Allow users to read their own admin document during login
      allow get: if isSignedIn() && request.auth.uid == adminId;
      // Allow checking for existence of administrators (First Admin check)
      allow list: if isSignedIn();
      // Allow initialization of the first admin
      allow create: if isSignedIn();
      // Allow admins to manage other admins
      allow update, delete: if isSignedIn() && isExisting();
    }

    /**
     * @description Rules for service categories.
     */
    match /categories/{categoryId} {
      allow get, list: if true;
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Rules for the services collection used by the dashboard.
     */
    match /services/{serviceId} {
      allow get, list: if true;
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Rules for service providers (artisans).
     */
    match /providers/{providerId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update, delete: if isSignedIn() && isExisting();
    }

    /**
     * @description Rules for the reviews collection.
     */
    match /reviews/{reviewId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update, delete: if isSignedIn() && isExisting();
    }

    /**
     * @description Rules for the jobs collection.
     */
    match /jobs/{jobId} {
      allow get, list: if true;
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Rules for system-wide settings (lockouts, etc).
     */
    match /system_settings/{settingId} {
      allow get: if true;
      allow write: if isSignedIn();
    }

    /**
     * @description Rules for audit and provider logs.
     */
    match /auditLogs/{logId} {
      allow list, get, create: if isSignedIn();
    }
    match /provider_logs/{logId} {
      allow list, get, create: if isSignedIn();
    }
  }
}
